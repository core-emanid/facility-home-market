---
---

<!-- TODO: email validation and api integration -->

<div class="bg-base-100 rounded-[24px] w-full lg:max-w-[60%] border-black border-1">
    <h2 class="text-center text-3xl lg:text-5xl font-bold py-10">Fale com a Facility!</h2>
    <form class="p-4 grid grid-cols-1 lg:grid-cols-2">
        <div class="grid mx-4 space-y-2">
            <div class="form-control">
                <!-- <label class="label">
                  <span class="label-text">Nome</span>
                </label> -->
                <input type="text" placeholder="Nome" id="nome" class="input rounded-full shadow-xl placeholder:text-neutral" />
            </div>
            <div class="form-control">
                <!-- <label class="label">
                  <span class="label-text">Telefone</span>
                </label> -->
                <input type="text" placeholder="Telefone" id="telefone" class="input rounded-full shadow-xl placeholder:text-neutral"  />
            </div>
            <div class="form-control">
                <!-- <label class="label">
                  <span class="label-text">Email</span>
                </label> -->
                <input type="email" placeholder="Email" id="email" class="input rounded-full shadow-xl placeholder:text-neutral"  />
            </div>    
        </div>
        <div class="grid mx-4 space-y-2 max-lg:items-center">
            <div class="form-control">
                <!-- <label class="label">
                  <span class="label-text">Cidade</span>
                </label> -->
                <input type="text" placeholder="Cidade" id="cidade" class="input rounded-full shadow-xl placeholder:text-neutral"  />
            </div>
            <div class="form-control">
                <!-- <label class="label">
                  <span class="label-text">Bairro</span>
                </label> -->
                <input type="text" placeholder="Bairro" id="bairro" class="input rounded-full shadow-xl placeholder:text-neutral"  />
            </div>
            <div class="form-control w-full">
                <!-- <label class="label">
                    <span class="label-text">.</span>
                </label> -->
                <span class="flex w-full justify-center">
                    <select class="select select-bordered max-w-xs shadow-xl placeholder:text-neutral" id="categoria">
                        <option selected>Sou Morador(a)</option>
                        <option>Sou SÃ­ndico(a)</option>
                        <option>Sou Administrador(a)</option>
                    </select>
                </span>
            </div>
        </div>
    </form>
    <div class="flex w-full justify-center pt-2 pb-6">
        <button class="btn btn-primary w-[90%] bg-accent border-none rounded-full text-base-100" onclick="submitForm()">Enviar</button>
    </div>
</div>



<script is:inline>

    const get = (id) => document.getElementById(id) || { value: '' };

    const submitForm = () => {
        // TODO: timestamp logic to avoid flood
        const token = localStorage.getItem("token");
        if(token){
			alert('FUNCIONOU');
        }		
        saveInput()
        sendmail()
    }

    // save and retrieve generic formdata from localstorage
    const getFormData = () => {
        const store = Object.create(null)
        store.nome = get('nome')?.value
        store.telefone = get('telefone')?.value
        store.email = get('email').value
        store.cidade = get('cidade')?.value
        store.bairro = get('bairro')?.value
        store.categoria = get('categoria')?.value
        return store
    }

    const saveInput = () => {
        const { message, subject, ...rest } = getFormData()
        localStorage.setItem('contactinfo', JSON.stringify(rest))
    }

    // const retrieveInfo = () => {
    //     const store = JSON.parse(localStorage.getItem('contactinfo') || '{}')
    //     get('name').value = store.name || ''
    //     get('surname').value = store.surname || ''
    //     get('email').value = store.email || ''
    //     get('tel').value = store.tel || ''
    // }
    // end: localstorage

    // This kicks thing of, should really be on window.onload but...
    const submitBtn = document.querySelector('[type="submit"]');;
    submitBtn?.addEventListener('click', submitForm);
    // retrieveInfo()
    ;[...document.querySelectorAll('input')][0]?.focus({
        preventScroll: true
    })
    // window.onload = () => {} // don't know why this wont work

    const sendmail = async () => {
        const { 
            nome,
            telefone,
            email,
            cidade,
            bairro,
            categoria
        } = getFormData();
        const data = await fetch('/api/sendmail.json', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ nome, telefone, email, cidade, bairro, categoria }),
        }).then((res) => {
            if (!res.ok) {
                throw new Error(res.status)
            }
            return res.json()
        }).catch((err) => {
            console.log('Error', err)
            throw new Error('Network error.')
        })
        console.log(data) // Here is the response from backend
    }

</script>


